include("packages.jl")
include("slowfast_commoncode.jl")



# Figure 2 (white noise and isoclines)
using DataFrames
using CSV

wn_data05_short = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff05_short.csv", DataFrame)
wn_data07_short = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff07_short.csv", DataFrame)
wn_data06_short = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff06_short.csv", DataFrame)
wn_data08_short = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff08_short.csv", DataFrame)
wn_data05_long = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff05_long.csv", DataFrame)
wn_data06_long = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff06_long.csv", DataFrame)
wn_data07_long = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff07_long.csv", DataFrame)
wn_data08_long = CSV.read("/home/chrisgg/julia/TimeDelays/data/wn_eff08_long.csv", DataFrame)

let
    figure2 = figure(figsize = (10,5))
    subplot(2,4,1)
    iso_plot(0.0:0.1:3.0, RozMacPar(e = 0.5))
    title("Non-excitable\n(Real λ)")
    ylim(0,2.5)
    xlim(0.0,3.0)
    ylabel("Consumer")
    xlabel("Resource")
    subplot(2,4,2)
    iso_plot(0.0:0.1:3.0, RozMacPar(e = 0.6))
    title("Excitable\n(Complex λ)")
    xlabel("Resource")
    ylim(0,2.5)
    xlim(0.0,3.0)
    subplot(2,4,3)
    iso_plot(0.0:0.1:3.0, RozMacPar(e = 0.7))
    title("Excitable\n(Near Hopf)")
    xlabel("Resource")
    ylim(0,2.5)
    xlim(0.0,3.0)
    subplot(2,4,4)
    iso_plot(0.0:0.1:3.0, RozMacPar(e = 0.8))
    ylim(0,2.5)
    xlim(0.0,3.0)
    title("Canard")
    xlabel("Resource")
    subplot(2,4,5)
    plot(1 ./ wn_data05_short.xrange, wn_data05_short.canard, color = "black", linestyle = "dashed")
    plot(1 ./ wn_data05_long.xrange, wn_data05_long.canard, color = "black", linestyle = "dotted")
    ylabel("Proportion with\nquasi-canard")
    xlabel("1/ϵ")
    ylim(0,1)
    subplot(2,4,6)
    plot(1 ./ wn_data06_short.xrange, wn_data06_short.canard, color = "black", linestyle = "dashed")
    plot(1 ./ wn_data06_long.xrange, wn_data06_long.canard, color = "black", linestyle = "dotted")
    ylim(0,1)
    xlabel("1/ϵ")
    subplot(2,4,7)
    plot(1 ./ wn_data07_short.xrange, wn_data07_short.canard, color = "black", linestyle = "dashed")
    plot(1 ./ wn_data07_long.xrange, wn_data07_long.canard, color = "black", linestyle = "dotted")
    xlabel("1/ϵ")
    ylim(0,1)
    subplot(2,4,8)
    plot(1 ./ wn_data08_short.xrange, wn_data08_short.canard, color = "black", linestyle = "dashed")
    plot(1 ./ wn_data08_long.xrange, wn_data08_long.canard, color = "black", linestyle = "dotted")
    xlabel("1/ϵ")
    ylim(0,1)
    tight_layout()
    annotate("a)", (32, 330), xycoords = "figure points", fontsize = 15)
    annotate("b)", (200, 330), xycoords = "figure points", fontsize = 15)
    annotate("c)", (370, 330), xycoords = "figure points", fontsize = 15)
    annotate("d)", (545, 330), xycoords = "figure points", fontsize = 15)
    annotate("e)", (32, 165), xycoords = "figure points", fontsize = 15)
    annotate("f)", (200, 165), xycoords = "figure points", fontsize = 15)
    annotate("g)", (370, 165), xycoords = "figure points", fontsize = 15)
    annotate("h)", (545, 165), xycoords = "figure points", fontsize = 15)
    
    # return figure2
    savefig(joinpath(abpath(), "figs/canard_whitenoise_prop.pdf"))
end

#Inset plot in figure 2
# let
#     inset = figure()
#     plot(wn_data05_short.xrange[1:7], wn_data05_short.canard[1:7], color = "black", linestyle = "dashed", linewidth=10)
#     plot(wn_data05_long.xrange[1:7], wn_data05_long.canard[1:7], color = "black", linestyle = "dotted", linewidth=10)
#     ylim(0,0.25)
#     # return inset
#     savefig(joinpath(abpath(), "figs/canard_whitenoise_prop_inset.png"))
# end

# Figure 3 (time series of canards)
let
    sol_05_ep001 = RozMac_pert(0.01, 0.5, 1, 0.0, 1234, 5000.0, 3500.0:2.0:5000.0)
    sol_06_ep001 = RozMac_pert(0.01, 0.6, 1, 0.0, 1234, 5000.0, 3500.0:2.0:5000.0)
    sol_07_ep001 = RozMac_pert(0.01, 0.7, 1, 0.0, 1234, 5000.0, 3500.0:2.0:5000.0)
    timeseries = figure(figsize=(6,4))
    subplot(2,2,1)
    plot(sol_05_ep001.t, sol_05_ep001.u)
    title("e = 0.5, 1/ϵ = 100")
    ylim(0,2.5)
    ylabel("Biomass")
    subplot(2,2,2)
    plot(sol_06_ep001.t, sol_06_ep001.u)
    title("e = 0.6, 1/ϵ = 100")
    ylim(0,2.5)
    xlabel("Time")
    subplot(2,2,3)
    plot(sol_07_ep001.t, sol_07_ep001.u)
    title("e = 0.7, 1/ϵ = 100")
    ylabel("Biomass")
    ylim(0,2.5)
    subplot(2,2,4)
    iso_plot(0.0:0.1:3.0, RozMacPar(e = 0.5))
    plot(sol_07_ep001[1, :], sol_07_ep001[2, :], color = "purple", label = "e = 0.7, 1/ϵ = 100")
    plot(sol_05_ep001[1, :], sol_05_ep001[2, :], color = "red", label = "e = 0.5, 1/ϵ = 100")
    xlabel("Resource")
    ylabel("Consumer")
    ylim(0,2.5)
    xlim(0,3)
    legend()
    tight_layout()
    annotate("a)", (12, 265), xycoords = "figure points", fontsize = 15)
    annotate("b)", (220, 265), xycoords = "figure points", fontsize = 15)
    annotate("c)", (12, 130), xycoords = "figure points", fontsize = 15)
    annotate("d)", (220, 130), xycoords = "figure points", fontsize = 15)
    # return timeseries
    savefig(joinpath(abpath(), "figs/figure3.png"))
end

# Figure 4

rn_data_ep0004eff05 = CSV.read("/home/chrisgg/julia/TimeDelays/data/rn_ep0004eff05.csv", DataFrame)
rn_data_ep0004eff06 = CSV.read("/home/chrisgg/julia/TimeDelays/data/rn_ep0004eff06.csv", DataFrame)
rn_data_ep0004eff07 = CSV.read("/home/chrisgg/julia/TimeDelays/data/rn_ep0004eff07.csv", DataFrame)
rn_data_ep0079eff05 = CSV.read("/home/chrisgg/julia/TimeDelays/data/rn_ep0079eff05.csv", DataFrame)
rn_data_ep0079eff06 = CSV.read("/home/chrisgg/julia/TimeDelays/data/rn_ep0079eff06.csv", DataFrame)
rn_data_ep0079eff07 = CSV.read("/home/chrisgg/julia/TimeDelays/data/rn_ep0079eff07.csv", DataFrame)


let
    # tickmark0004 = eff_maxeigen_data(0.0004)
    # tickmark0079 = eff_maxeigen_data(0.079)
    figure4 = figure(figsize = (8,4))
    subplot(2,3,1)
    fill_between(rn_data_ep0004eff05.xrange, rn_data_ep0004eff05.canard, color="#5D3A9B", alpha = 0.3)
    fill_between(rn_data_ep0004eff05.xrange, rn_data_ep0004eff05.canard, rn_data_ep0004eff05.canard_plus_axial, color="blue", alpha = 0.3)
    fill_between(rn_data_ep0004eff05.xrange, fill(1.0,10), rn_data_ep0004eff05.canard_plus_axial, color="#E66100", alpha = 0.3)
    ylabel("Proportion")
    ylim(0,1)
    # title("a) e = 0.5,\nϵ = 0.004")
    subplot(2,3,2)
    fill_between(rn_data_ep0004eff06.xrange, rn_data_ep0004eff06.canard, color="#5D3A9B", alpha = 0.3)
    fill_between(rn_data_ep0004eff06.xrange, rn_data_ep0004eff06.canard, rn_data_ep0004eff06.canard_plus_axial, color="blue", alpha = 0.3)
    fill_between(rn_data_ep0004eff06.xrange, fill(1.0,10), rn_data_ep0004eff06.canard_plus_axial, color="#E66100", alpha = 0.3)
    xlabel("Noise correlation (t = -1)")
    ylim(0,1)
    # title("b) e = 0.6,\nϵ = 0.004")
    subplot(2,3,3)
    fill_between(rn_data_ep0004eff07.xrange, rn_data_ep0004eff07.canard, color="#5D3A9B", alpha = 0.3)
    fill_between(rn_data_ep0004eff07.xrange, rn_data_ep0004eff07.canard, rn_data_ep0004eff07.canard_plus_axial, color="blue", alpha = 0.3)
    fill_between(rn_data_ep0004eff07.xrange, fill(1.0,10), rn_data_ep0004eff07.canard_plus_axial, color="#E66100", alpha = 0.3)
    ylim(0,1)
    # title("c) e = 0.7,\nϵ = 0.004")
    # subplot(2,4,4)
    # plot(tickmark0004[:,1], tickmark0004[:,2], color = "black")
    # fill([0.441,0.696, 0.696, 0.441], [0.1, 0.1, -0.35, -0.35], "blue", alpha=0.3)
    # fill([0.696,0.71, 0.71, 0.696], [0.1, 0.1, -0.35, -0.35], "orange", alpha=0.3)
    # hlines(0.0, 0.4,0.8, linestyles = "dashed", linewidth = 0.5)
    # vlines([0.5,0.6,0.7], ymin = -0.35, ymax = 0.1, color = "green")
    # vlines([0.441, 0.710], ymin = -0.35, ymax = 0.1, linestyles = "dashed")
    # xlabel("Efficiency")
    # ylabel("Re(λₘₐₓ)")
    # xlim(0.4, 0.8)
    # ylim(-0.35, 0.1)
    # title("d) ϵ = 0.004")

    subplot(2,3,4)
    fill_between(rn_data_ep0079eff05.xrange, rn_data_ep0079eff05.canard, color="#5D3A9B", alpha = 0.3)
    fill_between(rn_data_ep0079eff05.xrange, rn_data_ep0079eff05.canard, rn_data_ep0079eff05.canard_plus_axial, color="blue", alpha = 0.3)
    fill_between(rn_data_ep0079eff05.xrange, fill(1.0,10), rn_data_ep0079eff05.canard_plus_axial, color="#E66100", alpha = 0.3)
    ylabel("Proportion")
    ylim(0,1)
    # title("e) e = 0.5,\nϵ = 0.079")
    subplot(2,3,5)
    fill_between(rn_data_ep0079eff06.xrange, rn_data_ep0079eff06.canard, color="#5D3A9B", alpha = 0.3)
    fill_between(rn_data_ep0079eff06.xrange, rn_data_ep0079eff06.canard, rn_data_ep0079eff06.canard_plus_axial, color="blue", alpha = 0.3)
    fill_between(rn_data_ep0079eff06.xrange, fill(1.0,10), rn_data_ep0079eff06.canard_plus_axial, color="#E66100", alpha = 0.3)
    xlabel("Noise correlation (t = -1)")
    ylim(0,1)
    # title("f) e = 0.6,\nϵ = 0.079")
    subplot(2,3,6)
    fill_between(rn_data_ep0079eff07.xrange, rn_data_ep0079eff07.canard, color="#5D3A9B", alpha = 0.3)
    fill_between(rn_data_ep0079eff07.xrange, rn_data_ep0079eff07.canard, rn_data_ep0079eff07.canard_plus_axial, color="blue", alpha = 0.3)
    fill_between(rn_data_ep0079eff07.xrange, fill(1.0,10), rn_data_ep0079eff07.canard_plus_axial, color="#E66100", alpha = 0.3)
    ylim(0,1)
    # title("g) e = 0.7,\nϵ = 0.079")
    # subplot(2,4,8)
    # plot(tickmark0079[:,1], tickmark0079[:,2], color = "black")
    # fill([0.441,0.60055, 0.60055, 0.441], [0.1, 0.1, -0.35, -0.35], "blue", alpha=0.3)
    # fill([0.60055,0.71, 0.71, 0.60055], [0.1, 0.1, -0.35, -0.35], "orange", alpha=0.3)
    # hlines(0.0, 0.4,0.8, linestyles = "dashed", linewidth = 0.5)
    # vlines([0.5,0.6,0.7], ymin = -0.35, ymax = 0.1, color = "green")
    # vlines([0.441, 0.710], ymin = -0.35, ymax = 0.1, linestyles = "dashed")
    # xlabel("Efficiency")
    # ylabel("Re(λₘₐₓ)")
    # xlim(0.4, 0.8)
    # ylim(-0.35, 0.1)
    # title("h) ϵ = 0.079")
    tight_layout()
    annotate("a)", (20, 280), xycoords = "figure points", fontsize = 15)
    annotate("b)", (205, 280), xycoords = "figure points", fontsize = 15)
    annotate("c)", (385, 280), xycoords = "figure points", fontsize = 15)
    annotate("d)", (20, 140), xycoords = "figure points", fontsize = 15)
    annotate("e)", (205, 140), xycoords = "figure points", fontsize = 15)
    annotate("f)", (385, 140), xycoords = "figure points", fontsize = 15)
    
    # return figure4
    savefig(joinpath(abpath(), "figs/canard_rednoise_prop.pdf"))
end



# Figure 5 (schematic B)

let 
    figure5 = figure(figsize = (3,4))
    subplot(2,1,1)
    roz_mac_plot(0.01, 0.45, 2, 0.3)
    subplot(2,1,2)
    roz_mac_plot(0.01, 0.45, 2, 0.3)
    tight_layout()
    # return figure5
    savefig(joinpath(abpath(), "figs/figure5.pdf"))
end

#Original Figure 1 (proportion real) - replaced with proof
# include("slowfast_eigen.jl")

# let
#     prop_real = figure()
#     data = findRCdivide_epx_data()
#     plot(data[:,1], data[:,2], color = "black")
#     fill_between(data[:,1], data[:,2], color = "blue", alpha=0.3)
#     fill_between(data[:,1], fill(1.0, length(data[:,2])), data[:,2], color = "orange", alpha=0.3)
#     xlim(-0.05,2.05)
#     #ylim(0.410, 1)
#     ylabel("Proportion Real", fontsize = 15)
#     xlabel("ε", fontsize = 15)
#     return prop_real
#     # savefig(joinpath(abpath(), "figs/epsilonxaxis_propReal.png"))
# end


# let
#     data = eff_maxeigen_data(0.01)
#     maxeigen_ep001 = figure()
#     plot(data[:,1], data[:,2], color = "black")
#     title("ϵ = 0.01")
#     ylabel("Re(λₘₐₓ)", fontsize = 15)
#     xlim(0.4, 0.8)
#     ylim(-0.35, 0.1)
#     xlabel("Efficiency", fontsize = 15)
#     hlines(0.0, 0.4,0.8, linestyles = "dashed", linewidth = 0.5)
#     vlines([0.441, 0.710], ymin = -0.35, ymax = 0.1, linestyles = "dashed")
#     fill([0.441,0.65415, 0.65415, 0.441], [0.1, 0.1, -0.35, -0.35], "blue", alpha=0.3)
#     fill([0.65415, 0.710, 0.710, 0.65415], [0.1, 0.1, -0.35, -0.35], "orange", alpha=0.3)
#     annotate("TC", (90, 298), xycoords = "figure points", fontsize = 12)
#     annotate("H", (335, 298), xycoords = "figure points", fontsize = 12)
#     # return maxeigen_ep001
#     savefig(joinpath(abpath(), "figs/maxeigen_ep001.png"))
# end

# let
#     data = eff_maxeigen_data(0.8)
#     maxeigen_ep08 = figure()
#     plot(data[:,1], data[:,2], color = "black")
#     title("ϵ = 0.8")
#     ylabel("Re(λₘₐₓ)", fontsize = 15)
#     xlabel("Efficiency", fontsize = 15)
#     xlim(0.4, 0.8)
#     ylim(-0.35, 0.1)
#     hlines(0.0, 0.4,0.8, linestyles = "dashed", linewidth = 0.5)
#     vlines([0.441, 0.710], ymin = -0.35, ymax = 0.1, linestyles = "dashed")
#     fill([0.441,0.529, 0.529, 0.441], [0.1, 0.1, -0.35, -0.35], "blue", alpha=0.3)
#     fill([0.529,0.710, 0.710, 0.529], [0.1, 0.1, -0.35, -0.35], "orange", alpha=0.3)
#     annotate("TC", (86, 298), xycoords = "figure points", fontsize = 12)
#     annotate("H", (330, 298), xycoords = "figure points", fontsize = 12)
#     return maxeigen_ep08
#     # savefig(joinpath(abpath(), "figs/maxeigen_ep08.png"))
# end


# let
#     data = eff_maxeigen_data(0.079)
#     maxeigen_ep0079 = figure()
#     plot(data[:,1], data[:,2], color = "black")
#     ylabel("Re(λₘₐₓ)", fontsize = 15)
#     xlim(0.4, 0.8)
#     ylim(-0.35, 0.1)
#     xlabel("Efficiency", fontsize = 15)
#     hlines(0.0, 0.4,0.8, linestyles = "dashed", linewidth = 0.5)
#     vlines([0.5,0.6,0.7], ymin = -0.35, ymax = 0.1, color = "green")
#     vlines([0.441, 0.710], ymin = -0.35, ymax = 0.1, linestyles = "dashed")
#     fill([0.441,0.60055, 0.60055, 0.441], [0.1, 0.1, -0.35, -0.35], "blue", alpha=0.3)
#     fill([0.60055,0.71, 0.71, 0.60055], [0.1, 0.1, -0.35, -0.35], "orange", alpha=0.3)
#     annotate("TC", (90, 298), xycoords = "figure points", fontsize = 12)
#     annotate("H", (335, 298), xycoords = "figure points", fontsize = 12)
#     # return maxeigen_ep0079
#     savefig(joinpath(abpath(), "figs/maxeigen_ep0079.png"))
# end


# let
#     data = eff_maxeigen_data(0.004)
#     maxeigen_ep0079 = figure()
#     plot(data[:,1], data[:,2], color = "black")
#     ylabel("Re(λₘₐₓ)", fontsize = 15)
#     xlim(0.4, 0.8)
#     ylim(-0.35, 0.1)
#     xlabel("Efficiency", fontsize = 15)
#     hlines(0.0, 0.4,0.8, linestyles = "dashed", linewidth = 0.5)
#     vlines([0.5,0.6,0.7], ymin = -0.35, ymax = 0.1, color = "green")
#     vlines([0.441, 0.710], ymin = -0.35, ymax = 0.1, linestyles = "dashed")
#     fill([0.441,0.60055, 0.60055, 0.441], [0.1, 0.1, -0.35, -0.35], "blue", alpha=0.3)
#     fill([0.60055,0.71, 0.71, 0.60055], [0.1, 0.1, -0.35, -0.35], "orange", alpha=0.3)
#     annotate("TC", (90, 298), xycoords = "figure points", fontsize = 12)
#     annotate("H", (335, 298), xycoords = "figure points", fontsize = 12)
#     return maxeigen_ep0079
#     #savefig(joinpath(abpath(), "figs/maxeigen_ep0079.png"))
# end